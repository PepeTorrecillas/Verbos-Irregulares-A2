<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Verbos irregulares A2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 600px;
      padding: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 8px;
      text-align: center;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #555;
      text-align: center;
      margin-bottom: 12px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    select, button {
      font-size: 0.95rem;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #fff;
    }

    button {
      cursor: pointer;
      border: none;
      background: #2563eb;
      color: white;
      font-weight: 500;
    }

    button:disabled {
      background: #9ca3af;
      cursor: default;
    }

    .status {
      font-size: 0.9rem;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 4px;
    }

    .status span {
      background: #e5e7eb;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .table th,
    .table td {
      border: 1px solid #e5e7eb;
      padding: 6px;
      text-align: left;
    }

    .table th {
      background: #f9fafb;
      font-weight: 600;
    }

    input[type="text"] {
      width: 100%;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
    }

    .shown-cell {
      background: #ecfdf5;
      font-weight: 600;
    }

    .feedback {
      font-size: 0.85rem;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed #e5e7eb;
    }

    .feedback-line {
      margin: 2px 0;
    }

    .ok {
      color: #15803d;
      font-weight: 600;
    }

    .bad {
      color: #b91c1c;
      font-weight: 600;
    }

    .buttons-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .summary {
      margin-top: 10px;
      font-size: 0.95rem;
      font-weight: 500;
      text-align: center;
    }

    .muted {
      color: #6b7280;
      font-size: 0.85rem;
      text-align: center;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Verbos irregulares A2</h1>
      <div class="subtitle">
        Una columna se muestra como pista. Completa las demás y corrige antes de pasar a la siguiente.
      </div>

      <div class="controls">
        <label>
          Preguntas:
          <select id="numQuestions">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="20">20</option>
          </select>
        </label>
        <button id="startBtn">Empezar</button>
      </div>

      <div class="status">
        <span id="qInfo">Sin empezar</span>
        <span id="scoreInfo">Puntuación: 0 / 0</span>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>PRESENT</th>
            <th>PAST SIMPLE</th>
            <th>PAST PARTICIPLE</th>
            <th>TRANSLATE</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td id="cellPresent"></td>
            <td id="cellPastSimple"></td>
            <td id="cellPastParticiple"></td>
            <td id="cellTranslate"></td>
          </tr>
          <tr>
            <td id="inputPresentCell"></td>
            <td id="inputPastSimpleCell"></td>
            <td id="inputPastParticipleCell"></td>
            <td id="inputTranslateCell"></td>
          </tr>
        </tbody>
      </table>

      <div class="buttons-row">
        <button id="checkBtn" disabled>Corregir</button>
        <button id="nextBtn" disabled>Siguiente</button>
      </div>

      <div id="feedback" class="feedback"></div>
      <div id="summary" class="summary"></div>
      <div class="muted">
        Truco: en traducción con dos significados (ej. <b>ser / estar</b>) basta con poner uno, o los dos.
      </div>
    </div>
  </div>

  <script>
    const verbs = [
      { present: "be",       pastSimple: "was / were", pastParticiple: "been",    translate: "ser / estar" },
      { present: "become",   pastSimple: "became",     pastParticiple: "become",  translate: "convertirse / volverse" },
      { present: "begin",    pastSimple: "began",      pastParticiple: "begun",   translate: "empezar" },
      { present: "break",    pastSimple: "broke",      pastParticiple: "broken",  translate: "romper" },
      { present: "bring",    pastSimple: "brought",    pastParticiple: "brought", translate: "traer" },
      { present: "build",    pastSimple: "built",      pastParticiple: "built",   translate: "construir" },
      { present: "buy",      pastSimple: "bought",     pastParticiple: "bought",  translate: "comprar" },
      { present: "can",      pastSimple: "could",      pastParticiple: "—",       translate: "poder" },
      { present: "catch",    pastSimple: "caught",     pastParticiple: "caught",  translate: "atrapar" },
      { present: "choose",   pastSimple: "chose",      pastParticiple: "chosen",  translate: "elegir" },
      { present: "come",     pastSimple: "came",       pastParticiple: "come",    translate: "venir" },
      { present: "cost",     pastSimple: "cost",       pastParticiple: "cost",    translate: "costar" },
      { present: "cut",      pastSimple: "cut",        pastParticiple: "cut",     translate: "cortar" },
      { present: "do",       pastSimple: "did",        pastParticiple: "done",    translate: "hacer" },
      { present: "dream",    pastSimple: "dreamt",     pastParticiple: "dreamt",  translate: "soñar" },
      { present: "drink",    pastSimple: "drank",      pastParticiple: "drunk",   translate: "beber" },
      { present: "drive",    pastSimple: "drove",      pastParticiple: "driven",  translate: "conducir" },
      { present: "eat",      pastSimple: "ate",        pastParticiple: "eaten",   translate: "comer" },
      { present: "fall",     pastSimple: "fell",       pastParticiple: "fallen",  translate: "caer" },
      { present: "feel",     pastSimple: "felt",       pastParticiple: "felt",    translate: "sentir" },
      { present: "find",     pastSimple: "found",      pastParticiple: "found",   translate: "encontrar" },
      { present: "fly",      pastSimple: "flew",       pastParticiple: "flown",   translate: "volar" },
      { present: "forget",   pastSimple: "forgot",     pastParticiple: "forgotten", translate: "olvidar" },
      { present: "get",      pastSimple: "got",        pastParticiple: "got",     translate: "conseguir / obtener" },
      { present: "give",     pastSimple: "gave",       pastParticiple: "given",   translate: "dar" },
      { present: "go",       pastSimple: "went",       pastParticiple: "gone",    translate: "ir" },
      { present: "grow",     pastSimple: "grew",       pastParticiple: "grown",   translate: "crecer" },
      { present: "have",     pastSimple: "had",        pastParticiple: "had",     translate: "tener" },
      { present: "hit",      pastSimple: "hit",        pastParticiple: "hit",     translate: "golpear" },
      { present: "keep",     pastSimple: "kept",       pastParticiple: "kept",    translate: "mantener / conservar" },
      { present: "know",     pastSimple: "knew",       pastParticiple: "known",   translate: "saber / conocer" },
      { present: "lay",      pastSimple: "laid",       pastParticiple: "laid",    translate: "colocar / poner" },
      { present: "learn",    pastSimple: "learnt",     pastParticiple: "learnt",  translate: "aprender" },
      { present: "leave",    pastSimple: "left",       pastParticiple: "left",    translate: "irse / dejar" },
      { present: "lend",     pastSimple: "lent",       pastParticiple: "lent",    translate: "prestar" },
      { present: "lose",     pastSimple: "lost",       pastParticiple: "lost",    translate: "perder" },
      { present: "make",     pastSimple: "made",       pastParticiple: "made",    translate: "hacer / fabricar" },
      { present: "meet",     pastSimple: "met",        pastParticiple: "met",     translate: "conocer / encontrarse" },
      { present: "pay",      pastSimple: "paid",       pastParticiple: "paid",    translate: "pagar" },
      { present: "put",      pastSimple: "put",        pastParticiple: "put",     translate: "poner" },
      { present: "read",     pastSimple: "read",       pastParticiple: "read",    translate: "leer" },
      { present: "ring",     pastSimple: "rang",       pastParticiple: "rung",    translate: "sonar / llamar" },
      { present: "run",      pastSimple: "ran",        pastParticiple: "run",     translate: "correr" },
      { present: "say",      pastSimple: "said",       pastParticiple: "said",    translate: "decir" },
      { present: "see",      pastSimple: "saw",        pastParticiple: "seen",    translate: "ver" },
      { present: "sell",     pastSimple: "sold",       pastParticiple: "sold",    translate: "vender" },
      { present: "send",     pastSimple: "sent",       pastParticiple: "sent",    translate: "enviar" },
      { present: "shut",     pastSimple: "shut",       pastParticiple: "shut",    translate: "cerrar" },
      { present: "sing",     pastSimple: "sang",       pastParticiple: "sung",    translate: "cantar" },
      { present: "sit",      pastSimple: "sat",        pastParticiple: "sat",     translate: "sentarse" },
      { present: "sleep",    pastSimple: "slept",      pastParticiple: "slept",   translate: "dormir" },
      { present: "speak",    pastSimple: "spoke",      pastParticiple: "spoken",  translate: "hablar" },
      { present: "spend",    pastSimple: "spent",      pastParticiple: "spent",   translate: "gastar / pasar" },
      { present: "stand",    pastSimple: "stood",      pastParticiple: "stood",   translate: "estar de pie" },
      { present: "steal",    pastSimple: "stole",      pastParticiple: "stolen",  translate: "robar" },
      { present: "swim",     pastSimple: "swam",       pastParticiple: "swum",    translate: "nadar" },
      { present: "take",     pastSimple: "took",       pastParticiple: "taken",   translate: "tomar / llevar" },
      { present: "teach",    pastSimple: "taught",     pastParticiple: "taught",  translate: "enseñar" },
      { present: "tell",     pastSimple: "told",       pastParticiple: "told",    translate: "decir / contar" },
      { present: "think",    pastSimple: "thought",    pastParticiple: "thought", translate: "pensar" },
      { present: "throw",    pastSimple: "threw",      pastParticiple: "thrown",  translate: "lanzar / tirar" },
      { present: "understand", pastSimple: "understood", pastParticiple: "understood", translate: "entender" },
      { present: "wake",     pastSimple: "woke",       pastParticiple: "woken",   translate: "despertar" },
      { present: "wear",     pastSimple: "wore",       pastParticiple: "worn",    translate: "llevar puesto / vestir" },
      { present: "win",      pastSimple: "won",        pastParticiple: "won",     translate: "ganar" },
      { present: "write",    pastSimple: "wrote",      pastParticiple: "written", translate: "escribir" }
    ];

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function normalize(str) {
      return str
        .toLowerCase()
        .trim()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, " ")
        .replace(" / ", "/");
    }

    function isTranslationCorrect(user, correct) {
      const normCorrect = normalize(correct);
      let normUser = normalize(user);
      normUser = normUser.replace(/\s*y\s*/g, "/").replace(/,/g, "/");

      const correctParts = normCorrect.split("/").map(p => p.trim()).filter(Boolean);
      const userParts = normUser.split("/").map(p => p.trim()).filter(Boolean);

      for (const up of userParts) {
        for (const cp of correctParts) {
          if (up === cp) return true;
        }
      }
      return false;
    }

    let questions = [];
    let currentIndex = -1;
    let totalCorrect = 0;
    let totalPossible = 0;
    let currentShownCol = 0;

    const numQuestionsSelect = document.getElementById("numQuestions");
    const startBtn = document.getElementById("startBtn");
    const checkBtn = document.getElementById("checkBtn");
    const nextBtn = document.getElementById("nextBtn");
    const qInfo = document.getElementById("qInfo");
    const scoreInfo = document.getElementById("scoreInfo");
    const feedbackDiv = document.getElementById("feedback");
    const summaryDiv = document.getElementById("summary");

    const cellPresent = document.getElementById("cellPresent");
    const cellPastSimple = document.getElementById("cellPastSimple");
    const cellPastParticiple = document.getElementById("cellPastParticiple");
    const cellTranslate = document.getElementById("cellTranslate");

    const inputPresentCell = document.getElementById("inputPresentCell");
    const inputPastSimpleCell = document.getElementById("inputPastSimpleCell");
    const inputPastParticipleCell = document.getElementById("inputPastParticipleCell");
    const inputTranslateCell = document.getElementById("inputTranslateCell");

    let inputPresent, inputPastSimple, inputPastParticiple, inputTranslate;

    function createInput() {
      const inp = document.createElement("input");
      inp.type = "text";
      return inp;
    }

    function startQuiz() {
      const n = parseInt(numQuestionsSelect.value, 10);
      questions = shuffle(verbs).slice(0, n);
      currentIndex = -1;
      totalCorrect = 0;
      totalPossible = 0;
      summaryDiv.textContent = "";
      feedbackDiv.textContent = "";
      scoreInfo.textContent = "Puntuación: 0 / 0";
      nextQuestion();
    }

    function nextQuestion() {
      currentIndex++;
      feedbackDiv.textContent = "";

      if (currentIndex >= questions.length) {
        qInfo.textContent = "Ejercicio terminado";
        checkBtn.disabled = true;
        nextBtn.disabled = true;
        const pct = totalPossible > 0 ? ((totalCorrect * 100) / totalPossible).toFixed(1) : "0.0";
        summaryDiv.textContent = `Resultado final: ${totalCorrect} de ${totalPossible} (${pct} %)`;
        return;
      }

      const q = questions[currentIndex];
      currentShownCol = Math.floor(Math.random() * 4);

      qInfo.textContent = `Pregunta ${currentIndex + 1} de ${questions.length}`;

      [cellPresent, cellPastSimple, cellPastParticiple, cellTranslate].forEach(td => td.className = "");

      cellPresent.textContent = currentShownCol === 0 ? q.present : "";
      cellPastSimple.textContent = currentShownCol === 1 ? q.pastSimple : "";
      cellPastParticiple.textContent = currentShownCol === 2 ? q.pastParticiple : "";
      cellTranslate.textContent = currentShownCol === 3 ? q.translate : "";

      if (currentShownCol === 0) cellPresent.classList.add("shown-cell");
      if (currentShownCol === 1) cellPastSimple.classList.add("shown-cell");
      if (currentShownCol === 2) cellPastParticiple.classList.add("shown-cell");
      if (currentShownCol === 3) cellTranslate.classList.add("shown-cell");

      inputPresentCell.innerHTML = "";
      inputPastSimpleCell.innerHTML = "";
      inputPastParticipleCell.innerHTML = "";
      inputTranslateCell.innerHTML = "";

      if (currentShownCol !== 0) {
        inputPresent = createInput();
        inputPresentCell.appendChild(inputPresent);
      } else {
        inputPresentCell.textContent = "(pista)";
      }

      if (currentShownCol !== 1) {
        inputPastSimple = createInput();
        inputPastSimpleCell.appendChild(inputPastSimple);
      } else {
        inputPastSimpleCell.textContent = "(pista)";
      }

      if (currentShownCol !== 2 && q.pastParticiple !== "—") {
        inputPastParticiple = createInput();
        inputPastParticipleCell.appendChild(inputPastParticiple);
      } else if (q.pastParticiple === "—") {
        inputPastParticipleCell.textContent = "(no aplica)";
      } else {
        inputPastParticipleCell.textContent = "(pista)";
      }

      if (currentShownCol !== 3) {
        inputTranslate = createInput();
        inputTranslateCell.appendChild(inputTranslate);
      } else {
        inputTranslateCell.textContent = "(pista)";
      }

      checkBtn.disabled = false;
      nextBtn.disabled = true;
    }

    function checkCurrent() {
      const q = questions[currentIndex];
      let fb = "";
      let correctRow = 0;
      let possibleRow = 0;

      const ansPresent = currentShownCol !== 0 ? (inputPresent.value || "").trim() : q.present;
      const ansPastSimple = currentShownCol !== 1 ? (inputPastSimple.value || "").trim() : q.pastSimple;
      const ansPastParticiple =
        (currentShownCol !== 2 && q.pastParticiple !== "—") ? (inputPastParticiple.value || "").trim() : q.pastParticiple;
      const ansTranslate = currentShownCol !== 3 ? (inputTranslate.value || "").trim() : q.translate;

      fb += "<div class='feedback-line'><strong>Tus respuestas:</strong></div>";
      fb += `<div class='feedback-line'>PRESENT: ${ansPresent || "<i>(vacío)</i>"}</div>`;
      fb += `<div class='feedback-line'>PAST SIMPLE: ${ansPastSimple || "<i>(vacío)</i>"}</div>`;
      fb += `<div class='feedback-line'>PAST PARTICIPLE: ${ansPastParticiple || "<i>(vacío)</i>"}</div>`;
      fb += `<div class='feedback-line'>TRANSLATE: ${ansTranslate || "<i>(vacío)</i>"}</div>`;

      fb += "<div class='feedback-line' style='margin-top:6px;'><strong>Solución correcta:</strong></div>";
      fb += `<div class='feedback-line'>PRESENT: ${q.present}</div>`;
      fb += `<div class='feedback-line'>PAST SIMPLE: ${q.pastSimple}</div>`;
      fb += `<div class='feedback-line'>PAST PARTICIPLE: ${q.pastParticiple}</div>`;
      fb += `<div class='feedback-line'>TRANSLATE: ${q.translate}</div>`;

      if (currentShownCol !== 0) {
        possibleRow++;
        totalPossible++;
        if (normalize(ansPresent) === normalize(q.present)) {
          correctRow++;
          totalCorrect++;
          fb += `<div class='feedback-line ok'>✔ PRESENT correcto</div>`;
        } else {
          fb += `<div class='feedback-line bad'>✘ PRESENT incorrecto</div>`;
        }
      }

      if (currentShownCol !== 1) {
        possibleRow++;
        totalPossible++;
        if (normalize(ansPastSimple) === normalize(q.pastSimple)) {
          correctRow++;
          totalCorrect++;
          fb += `<div class='feedback-line ok'>✔ PAST SIMPLE correcto</div>`;
        } else {
          fb += `<div class='feedback-line bad'>✘ PAST SIMPLE incorrecto</div>`;
        }
      }

      if (currentShownCol !== 2 && q.pastParticiple !== "—") {
        possibleRow++;
        totalPossible++;
        if (normalize(ansPastParticiple) === normalize(q.pastParticiple)) {
          correctRow++;
          totalCorrect++;
          fb += `<div class='feedback-line ok'>✔ PAST PARTICIPLE correcto</div>`;
        } else {
          fb += `<div class='feedback-line bad'>✘ PAST PARTICIPLE incorrecto</div>`;
        }
      }

      if (currentShownCol !== 3) {
        possibleRow++;
        totalPossible++;
        if (isTranslationCorrect(ansTranslate, q.translate)) {
          correctRow++;
          totalCorrect++;
          fb += `<div class='feedback-line ok'>✔ TRANSLATE correcto</div>`;
        } else {
          fb += `<div class='feedback-line bad'>✘ TRANSLATE incorrecto</div>`;
        }
      }

      fb += `<div class='feedback-line' style='margin-top:4px;'><strong>Aciertos en esta fila:</strong> ${correctRow} de ${possibleRow}</div>`;

      feedbackDiv.innerHTML = fb;

      const pct = totalPossible > 0 ? ((totalCorrect * 100) / totalPossible).toFixed(1) : "0.0";
      scoreInfo.textContent = `Puntuación: ${totalCorrect} / ${totalPossible} (${pct} %)`;

      checkBtn.disabled = true;
      nextBtn.disabled = false;
    }

    startBtn.addEventListener("click", startQuiz);
    checkBtn.addEventListener("click", checkCurrent);
    nextBtn.addEventListener("click", nextQuestion);
  </script>
</body>
</html>