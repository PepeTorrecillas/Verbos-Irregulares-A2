<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Verbos irregulares A2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 800px;
      padding: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 8px;
      text-align: center;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #555;
      text-align: center;
      margin-bottom: 12px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    select, button {
      font-size: 0.95rem;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #fff;
    }

    button {
      cursor: pointer;
      border: none;
      background: #2563eb;
      color: white;
      font-weight: 500;
    }

    button:disabled {
      background: #9ca3af;
      cursor: default;
    }

    .status {
      font-size: 0.9rem;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 4px;
    }

    .status span {
      background: #e5e7eb;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .table th,
    .table td {
      border: 1px solid #e5e7eb;
      padding: 6px;
      text-align: left;
    }

    .table th {
      background: #f9fafb;
      font-weight: 600;
    }

    input[type="text"] {
      width: 100%;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
    }

    .shown-cell {
      background: #ecfdf5;
      font-weight: 600;
    }

    .ok-cell {
      background: #dcfce7;
    }

    .bad-cell {
      background: #fee2e2;
    }

    .feedback {
      font-size: 0.85rem;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px dashed #e5e7eb;
    }

    .buttons-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .summary {
      margin-top: 10px;
      font-size: 0.95rem;
      font-weight: 500;
      text-align: center;
    }

    .muted {
      color: #6b7280;
      font-size: 0.85rem;
      text-align: center;
      margin-top: 8px;
    }

    .row-result {
      text-align: center;
      font-weight: 600;
      min-width: 60px;
    }

    .row-result.ok {
      color: #15803d;
    }

    .row-result.bad {
      color: #b91c1c;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Verbos irregulares A2</h1>
      <div class="subtitle">
        Una columna se muestra como pista. Completa las demÃ¡s para cada fila y corrige al final.
      </div>

      <div class="controls">
        <label>
          Preguntas:
          <select id="numQuestions">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="20">20</option>
          </select>
        </label>
        <button id="startBtn">Empezar</button>
        <button id="checkBtn" disabled>Corregir todo</button>
      </div>

      <div class="status">
        <span id="qInfo">Sin empezar</span>
        <span id="scoreInfo">PuntuaciÃ³n: 0 / 0</span>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>PRESENT</th>
            <th>PAST SIMPLE</th>
            <th>PAST PARTICIPLE</th>
            <th>TRANSLATE</th>
            <th>Resultado</th>
          </tr>
        </thead>
        <tbody id="questionsBody">
          <!-- Las filas se generan por JavaScript -->
        </tbody>
      </table>

      <div id="feedback" class="feedback">
        Pulsa <b>Empezar</b> para generar las preguntas.
      </div>
      <div id="summary" class="summary"></div>
      <div class="muted">
        Truco: en traducciones con dos significados (ej. <b>ser / estar</b>) basta con poner uno, o los dos.
      </div>
    </div>
  </div>

  <script>
    const verbs = [
      { present: "be",       pastSimple: "was / were", pastParticiple: "been",    translate: "ser / estar" },
      { present: "become",   pastSimple: "became",     pastParticiple: "become",  translate: "convertirse / volverse" },
      { present: "begin",    pastSimple: "began",      pastParticiple: "begun",   translate: "empezar" },
      { present: "break",    pastSimple: "broke",      pastParticiple: "broken",  translate: "romper" },
      { present: "bring",    pastSimple: "brought",    pastParticiple: "brought", translate: "traer" },
      { present: "build",    pastSimple: "built",      pastParticiple: "built",   translate: "construir" },
      { present: "buy",      pastSimple: "bought",     pastParticiple: "bought",  translate: "comprar" },
      { present: "can",      pastSimple: "could",      pastParticiple: "â€”",       translate: "poder" },
      { present: "catch",    pastSimple: "caught",     pastParticiple: "caught",  translate: "atrapar" },
      { present: "choose",   pastSimple: "chose",      pastParticiple: "chosen",  translate: "elegir" },
      { present: "come",     pastSimple: "came",       pastParticiple: "come",    translate: "venir" },
      { present: "cost",     pastSimple: "cost",       pastParticiple: "cost",    translate: "costar" },
      { present: "cut",      pastSimple: "cut",        pastParticiple: "cut",     translate: "cortar" },
      { present: "do",       pastSimple: "did",        pastParticiple: "done",    translate: "hacer" },
      { present: "dream",    pastSimple: "dreamt",     pastParticiple: "dreamt",  translate: "soÃ±ar" },
      { present: "drink",    pastSimple: "drank",      pastParticiple: "drunk",   translate: "beber" },
      { present: "drive",    pastSimple: "drove",      pastParticiple: "driven",  translate: "conducir" },
      { present: "eat",      pastSimple: "ate",        pastParticiple: "eaten",   translate: "comer" },
      { present: "fall",     pastSimple: "fell",       pastParticiple: "fallen",  translate: "caer" },
      { present: "feel",     pastSimple: "felt",       pastParticiple: "felt",    translate: "sentir" },
      { present: "find",     pastSimple: "found",      pastParticiple: "found",   translate: "encontrar" },
      { present: "fly",      pastSimple: "flew",       pastParticiple: "flown",   translate: "volar" },
      { present: "forget",   pastSimple: "forgot",     pastParticiple: "forgotten", translate: "olvidar" },
      { present: "get",      pastSimple: "got",        pastParticiple: "got",     translate: "conseguir / obtener" },
      { present: "give",     pastSimple: "gave",       pastParticiple: "given",   translate: "dar" },
      { present: "go",       pastSimple: "went",       pastParticiple: "gone",    translate: "ir" },
      { present: "grow",     pastSimple: "grew",       pastParticiple: "grown",   translate: "crecer" },
      { present: "have",     pastSimple: "had",        pastParticiple: "had",     translate: "tener" },
      { present: "hit",      pastSimple: "hit",        pastParticiple: "hit",     translate: "golpear" },
      { present: "keep",     pastSimple: "kept",       pastParticiple: "kept",    translate: "mantener / conservar" },
      { present: "know",     pastSimple: "knew",       pastParticiple: "known",   translate: "saber / conocer" },
      { present: "lay",      pastSimple: "laid",       pastParticiple: "laid",    translate: "colocar / poner" },
      { present: "learn",    pastSimple: "learnt",     pastParticiple: "learnt",  translate: "aprender" },
      { present: "leave",    pastSimple: "left",       pastParticiple: "left",    translate: "irse / dejar" },
      { present: "lend",     pastSimple: "lent",       pastParticiple: "lent",    translate: "prestar" },
      { present: "lose",     pastSimple: "lost",       pastParticiple: "lost",    translate: "perder" },
      { present: "make",     pastSimple: "made",       pastParticiple: "made",    translate: "hacer / fabricar" },
      { present: "meet",     pastSimple: "met",        pastParticiple: "met",     translate: "conocer / encontrarse" },
      { present: "pay",      pastSimple: "paid",       pastParticiple: "paid",    translate: "pagar" },
      { present: "put",      pastSimple: "put",        pastParticiple: "put",     translate: "poner" },
      { present: "read",     pastSimple: "read",       pastParticiple: "read",    translate: "leer" },
      { present: "ring",     pastSimple: "rang",       pastParticiple: "rung",    translate: "sonar / llamar" },
      { present: "run",      pastSimple: "ran",        pastParticiple: "run",     translate: "correr" },
      { present: "say",      pastSimple: "said",       pastParticiple: "said",    translate: "decir" },
      { present: "see",      pastSimple: "saw",        pastParticiple: "seen",    translate: "ver" },
      { present: "sell",     pastSimple: "sold",       pastParticiple: "sold",    translate: "vender" },
      { present: "send",     pastSimple: "sent",       pastParticiple: "sent",    translate: "enviar" },
      { present: "shut",     pastSimple: "shut",       pastParticiple: "shut",    translate: "cerrar" },
      { present: "sing",     pastSimple: "sang",       pastParticiple: "sung",    translate: "cantar" },
      { present: "sit",      pastSimple: "sat",        pastParticiple: "sat",     translate: "sentarse" },
      { present: "sleep",    pastSimple: "slept",      pastParticiple: "slept",   translate: "dormir" },
      { present: "speak",    pastSimple: "spoke",      pastParticiple: "spoken",  translate: "hablar" },
      { present: "spend",    pastSimple: "spent",      pastParticiple: "spent",   translate: "gastar / pasar" },
      { present: "stand",    pastSimple: "stood",      pastParticiple: "stood",   translate: "estar de pie" },
      { present: "steal",    pastSimple: "stole",      pastParticiple: "stolen",  translate: "robar" },
      { present: "swim",     pastSimple: "swam",       pastParticiple: "swum",    translate: "nadar" },
      { present: "take",     pastSimple: "took",       pastParticiple: "taken",   translate: "tomar / llevar" },
      { present: "teach",    pastSimple: "taught",     pastParticiple: "taught",  translate: "enseÃ±ar" },
      { present: "tell",     pastSimple: "told",       pastParticiple: "told",    translate: "decir / contar" },
      { present: "think",    pastSimple: "thought",    pastParticiple: "thought", translate: "pensar" },
      { present: "throw",    pastSimple: "threw",      pastParticiple: "thrown",  translate: "lanzar / tirar" },
      { present: "understand", pastSimple: "understood", pastParticiple: "understood", translate: "entender" },
      { present: "wake",     pastSimple: "woke",       pastParticiple: "woken",   translate: "despertar" },
      { present: "wear",     pastSimple: "wore",       pastParticiple: "worn",    translate: "llevar puesto / vestir" },
      { present: "win",      pastSimple: "won",        pastParticiple: "won",     translate: "ganar" },
      { present: "write",    pastSimple: "wrote",      pastParticiple: "written", translate: "escribir" }
    ];

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function normalize(str) {
      return str
        .toLowerCase()
        .trim()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // quita tildes
        .replace(/\s+/g, " ")
        .replace(" / ", "/");
    }

    function isTranslationCorrect(user, correct) {
      const normCorrect = normalize(correct);
      let normUser = normalize(user);
      normUser = normUser.replace(/\s*y\s*/g, "/").replace(/,/g, "/");

      const correctParts = normCorrect.split("/").map(p => p.trim()).filter(Boolean);
      const userParts = normUser.split("/").map(p => p.trim()).filter(Boolean);

      for (const up of userParts) {
        for (const cp of correctParts) {
          if (up === cp) return true;
        }
      }
      return false;
    }

    const numQuestionsSelect = document.getElementById("numQuestions");
    const startBtn = document.getElementById("startBtn");
    const checkBtn = document.getElementById("checkBtn");
    const qInfo = document.getElementById("qInfo");
    const scoreInfo = document.getElementById("scoreInfo");
    const feedbackDiv = document.getElementById("feedback");
    const summaryDiv = document.getElementById("summary");
    const tbody = document.getElementById("questionsBody");

    const COL_PRESENT = 0;
    const COL_PAST_SIMPLE = 1;
    const COL_PAST_PARTICIPLE = 2;
    const COL_TRANSLATE = 3;
    const propByCol = ["present", "pastSimple", "pastParticiple", "translate"];

    let questions = []; // {verb, shownCol}
    let rowStats = [];  // {correct, possible, td}
    let totalCorrect = 0;
    let totalPossible = 0;

    function startQuiz() {
      const n = parseInt(numQuestionsSelect.value, 10);
      const selected = shuffle(verbs).slice(0, n);

      questions = selected.map(v => ({
        verb: v,
        shownCol: Math.floor(Math.random() * 4)
      }));

      rowStats = questions.map(() => ({ correct: 0, possible: 0, td: null }));
      totalCorrect = 0;
      totalPossible = 0;

      scoreInfo.textContent = "PuntuaciÃ³n: 0 / 0";
      summaryDiv.textContent = "";
      feedbackDiv.textContent = "Escribe tus respuestas y pulsa Â«Corregir todoÂ» para ver los aciertos.";
      qInfo.textContent = `Total de preguntas: ${questions.length}`;

      // Limpiar tabla
      tbody.innerHTML = "";

      questions.forEach((q, index) => {
        const tr = document.createElement("tr");
        const v = q.verb;

        for (let col = 0; col < 4; col++) {
          const td = document.createElement("td");
          const prop = propByCol[col];
          const value = v[prop];

          if (col === q.shownCol || (col === COL_PAST_PARTICIPLE && value === "â€”")) {
            // Se muestra como pista o no aplica
            td.textContent = value;
            if (col === q.shownCol) {
              td.classList.add("shown-cell");
            }
          } else {
            const input = document.createElement("input");
            input.type = "text";
            input.setAttribute("data-qindex", index);
            input.setAttribute("data-col", col);
            td.appendChild(input);
          }

          tr.appendChild(td);
        }

        const resultTd = document.createElement("td");
        resultTd.className = "row-result";
        resultTd.textContent = "â€”";
        tr.appendChild(resultTd);
        rowStats[index].td = resultTd;

        tbody.appendChild(tr);
      });

      checkBtn.disabled = false;
    }

    function correctAll() {
      if (questions.length === 0) return;

      totalCorrect = 0;
      totalPossible = 0;
      rowStats.forEach(stat => { stat.correct = 0; stat.possible = 0; if (stat.td) { stat.td.textContent = "â€”"; stat.td.classList.remove("ok", "bad"); } });

      // Quitar colores anteriores
      tbody.querySelectorAll("td").forEach(td => {
        td.classList.remove("ok-cell", "bad-cell");
      });

      const inputs = tbody.querySelectorAll("input[data-qindex]");
      inputs.forEach(input => {
        const qIndex = parseInt(input.getAttribute("data-qindex"), 10);
        const col = parseInt(input.getAttribute("data-col"), 10);
        const q = questions[qIndex].verb;
        const prop = propByCol[col];
        const correctVal = q[prop];
        const userVal = input.value || "";
        const td = input.parentElement;

        let isCorrect = false;

        if (prop === "translate") {
          isCorrect = isTranslationCorrect(userVal, correctVal);
        } else {
          isCorrect = (normalize(userVal) === normalize(correctVal));
        }

        totalPossible++;
        rowStats[qIndex].possible++;

        if (isCorrect) {
          totalCorrect++;
          rowStats[qIndex].correct++;
          td.classList.add("ok-cell");
        } else {
          td.classList.add("bad-cell");
        }
      });

      // Resultado por fila
      rowStats.forEach(stat => {
        if (!stat.td) return;
        if (stat.possible === 0) {
          stat.td.textContent = "";
          return;
        }
        stat.td.textContent = `${stat.correct}/${stat.possible}`;
        if (stat.correct === stat.possible) {
          stat.td.classList.add("ok");
        } else {
          stat.td.classList.add("bad");
        }
      });

      const pct = totalPossible > 0 ? ((totalCorrect * 100) / totalPossible).toFixed(1) : "0.0";
      scoreInfo.textContent = `PuntuaciÃ³n: ${totalCorrect} / ${totalPossible} (${pct} %)`;
      summaryDiv.textContent = pct >= 80
        ? "Â¡Muy bien! ðŸ’ª Buen dominio de estos verbos."
        : "Sigue practicando, verÃ¡s cÃ³mo sube la puntuaciÃ³n. ðŸ˜Š";

      checkBtn.disabled = true;
      feedbackDiv.textContent = "Revisa los colores de la tabla: verde = correcto, rojo = incorrecto. Pulsa Â«EmpezarÂ» para nuevo ejercicio.";
    }

    startBtn.addEventListener("click", startQuiz);
    checkBtn.addEventListener("click", correctAll);
  </script>
</body>
</html>