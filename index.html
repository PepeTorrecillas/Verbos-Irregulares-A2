<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Verbos irregulares A2</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f3f4f6;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 800px;
      padding: 16px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    h1 {
      font-size: 1.4rem;
      margin: 0 0 8px;
      text-align: center;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #555;
      text-align: center;
      margin-bottom: 12px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    label {
      font-size: 0.9rem;
    }

    select, button {
      font-size: 0.95rem;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #fff;
    }

    button {
      cursor: pointer;
      border: none;
      background: #2563eb;
      color: white;
      font-weight: 500;
    }

    button:disabled {
      background: #9ca3af;
      cursor: default;
    }

    .status {
      font-size: 0.9rem;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 4px;
    }

    .status span {
      background: #e5e7eb;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .table th,
    .table td {
      border: 1px solid #e5e7eb;
      padding: 6px;
      text-align: left;
    }

    .table th {
      background: #f9fafb;
      font-weight: 600;
    }

    input[type="text"] {
      width: 100%;
      padding: 4px 6px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
    }

    .shown-cell {
      background: #ecfdf5;
      font-weight: 600;
    }

    .ok-cell {
      background: #dcfce7;
    }

    .bad-cell {
      background: #fee2e2;
      font-weight: bold;
    }

    .row-result {
      text-align: center;
      font-weight: 600;
      min-width: 60px;
    }

    .row-result.ok {
      color: #15803d;
    }

    .row-result.bad {
      color: #b91c1c;
    }

    .summary {
      margin-top: 10px;
      font-size: 0.95rem;
      font-weight: 500;
      text-align: center;
      min-height: 2em;
    }

    .muted {
      color: #6b7280;
      font-size: 0.85rem;
      text-align: center;
      margin-top: 8px;
    }

    .choco-msg {
      display: inline-block;
      margin-top: 4px;
      color: #b91c1c;
      font-weight: 700;
      animation: bounce 0.9s infinite;
    }

    @keyframes bounce {
      0%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-6px);
      }
      60% {
        transform: translateY(3px);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Verbos irregulares A2</h1>
      <div class="subtitle">
        Una columna se muestra como pista. Completa las demÃ¡s para cada fila.
      </div>

      <div class="controls">
        <label>
          Preguntas:
          <select id="numQuestions">
            <option value="5">5</option>
            <option value="10" selected>10</option>
            <option value="20">20</option>
          </select>
        </label>

        <label>
          Modo:
          <select id="modeSelect">
            <option value="normal" selected>Normal</option>
            <option value="laura">Laura</option>
          </select>
        </label>

        <button id="startBtn">Empezar</button>
        <button id="checkBtn" disabled>Corregir todo</button>
      </div>

      <div class="status">
        <span id="qInfo">Sin empezar</span>
        <span id="scoreInfo">PuntuaciÃ³n: 0 / 0</span>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th data-hcol="0">PRESENT</th>
            <th data-hcol="1">PAST SIMPLE</th>
            <th data-hcol="2">PAST PARTICIPLE</th>
            <th data-hcol="3">TRANSLATE</th>
            <th>Resultado</th>
          </tr>
        </thead>
        <tbody id="questionsBody"></tbody>
      </table>

      <div id="summary" class="summary"></div>
      <div class="muted">
        Truco: si la traducciÃ³n tiene dos significados (Â«ser / estarÂ»), basta con poner uno.
      </div>
    </div>
  </div>

  <script>
    const verbs = [
      { present: "be", pastSimple: "was / were", pastParticiple: "been", translate: "ser / estar" },
      { present: "become", pastSimple: "became", pastParticiple: "become", translate: "convertirse / volverse" },
      { present: "begin", pastSimple: "began", pastParticiple: "begun", translate: "empezar" },
      { present: "break", pastSimple: "broke", pastParticiple: "broken", translate: "romper" },
      { present: "bring", pastSimple: "brought", pastParticiple: "brought", translate: "traer" },
      { present: "build", pastSimple: "built", pastParticiple: "built", translate: "construir" },
      { present: "buy", pastSimple: "bought", pastParticiple: "bought", translate: "comprar" },
      { present: "can", pastSimple: "could", pastParticiple: "â€”", translate: "poder" },
      { present: "catch", pastSimple: "caught", pastParticiple: "caught", translate: "atrapar" },
      { present: "choose", pastSimple: "chose", pastParticiple: "chosen", translate: "elegir" },
      { present: "come", pastSimple: "came", pastParticiple: "come", translate: "venir" },
      { present: "cost", pastSimple: "cost", pastParticiple: "cost", translate: "costar" },
      { present: "cut", pastSimple: "cut", pastParticiple: "cut", translate: "cortar" },
      { present: "do", pastSimple: "did", pastParticiple: "done", translate: "hacer" },
      { present: "dream", pastSimple: "dreamt", pastParticiple: "dreamt", translate: "soÃ±ar" },
      { present: "drink", pastSimple: "drank", pastParticiple: "drunk", translate: "beber" },
      { present: "drive", pastSimple: "drove", pastParticiple: "driven", translate: "conducir" },
      { present: "eat", pastSimple: "ate", pastParticiple: "eaten", translate: "comer" },
      { present: "fall", pastSimple: "fell", pastParticiple: "fallen", translate: "caer" },
      { present: "feel", pastSimple: "felt", pastParticiple: "felt", translate: "sentir" },
      { present: "find", pastSimple: "found", pastParticiple: "found", translate: "encontrar" },
      { present: "fly", pastSimple: "flew", pastParticiple: "flown", translate: "volar" },
      { present: "forget", pastSimple: "forgot", pastParticiple: "forgotten", translate: "olvidar" },
      { present: "get", pastSimple: "got", pastParticiple: "got", translate: "conseguir / obtener" },
      { present: "give", pastSimple: "gave", pastParticiple: "given", translate: "dar" },
      { present: "go", pastSimple: "went", pastParticiple: "gone", translate: "ir" },
      { present: "grow", pastSimple: "grew", pastParticiple: "grown", translate: "crecer" },
      { present: "have", pastSimple: "had", pastParticiple: "had", translate: "tener" },
      { present: "hit", pastSimple: "hit", pastParticiple: "hit", translate: "golpear" },
      { present: "keep", pastSimple: "kept", pastParticiple: "kept", translate: "mantener / conservar" },
      { present: "know", pastSimple: "knew", pastParticiple: "known", translate: "saber / conocer" },
      { present: "lay", pastSimple: "laid", pastParticiple: "laid", translate: "colocar / poner" },
      { present: "learn", pastSimple: "learnt", pastParticiple: "learnt", translate: "aprender" },
      { present: "leave", pastSimple: "left", pastParticiple: "left", translate: "irse / dejar" },
      { present: "lend", pastSimple: "lent", pastParticiple: "lent", translate: "prestar" },
      { present: "lose", pastSimple: "lost", pastParticiple: "lost", translate: "perder" },
      { present: "make", pastSimple: "made", pastParticiple: "made", translate: "hacer / fabricar" },
      { present: "meet", pastSimple: "met", pastParticiple: "met", translate: "conocer / encontrarse" },
      { present: "pay", pastSimple: "paid", pastParticiple: "paid", translate: "pagar" },
      { present: "put", pastSimple: "put", pastParticiple: "put", translate: "poner" },
      { present: "read", pastSimple: "read", pastParticiple: "read", translate: "leer" },
      { present: "ring", pastSimple: "rang", pastParticiple: "rung", translate: "sonar / llamar" },
      { present: "run", pastSimple: "ran", pastParticiple: "run", translate: "correr" },
      { present: "say", pastSimple: "said", pastParticiple: "said", translate: "decir" },
      { present: "see", pastSimple: "saw", pastParticiple: "seen", translate: "ver" },
      { present: "sell", pastSimple: "sold", pastParticiple: "sold", translate: "vender" },
      { present: "send", pastSimple: "sent", pastParticiple: "sent", translate: "enviar" },
      { present: "shut", pastSimple: "shut", pastParticiple: "shut", translate: "cerrar" },
      { present: "sing", pastSimple: "sang", pastParticiple: "sung", translate: "cantar" },
      { present: "sit", pastSimple: "sat", pastParticiple: "sat", translate: "sentarse" },
      { present: "sleep", pastSimple: "slept", pastParticiple: "slept", translate: "dormir" },
      { present: "speak", pastSimple: "spoke", pastParticiple: "spoken", translate: "hablar" },
      { present: "spend", pastSimple: "spent", pastParticiple: "spent", translate: "gastar / pasar" },
      { present: "stand", pastSimple: "stood", pastParticiple: "stood", translate: "estar de pie" },
      { present: "steal", pastSimple: "stole", pastParticiple: "stolen", translate: "robar" },
      { present: "swim", pastSimple: "swam", pastParticiple: "swum", translate: "nadar" },
      { present: "take", pastSimple: "took", pastParticiple: "taken", translate: "tomar / llevar" },
      { present: "teach", pastSimple: "taught", pastParticiple: "taught", translate: "enseÃ±ar" },
      { present: "tell", pastSimple: "told", pastParticiple: "told", translate: "decir / contar" },
      { present: "think", pastSimple: "thought", pastParticiple: "thought", translate: "pensar" },
      { present: "throw", pastSimple: "threw", pastParticiple: "thrown", translate: "lanzar / tirar" },
      { present: "understand", pastSimple: "understood", pastParticiple: "understood", translate: "entender" },
      { present: "wake", pastSimple: "woke", pastParticiple: "woken", translate: "despertar" },
      { present: "wear", pastSimple: "wore", pastParticiple: "worn", translate: "llevar puesto / vestir" },
      { present: "win", pastSimple: "won", pastParticiple: "won", translate: "ganar" },
      { present: "write", pastSimple: "wrote", pastParticiple: "written", translate: "escribir" }
    ];

    const COLS = ["present", "pastSimple", "pastParticiple", "translate"];
    const HEADERS = ["PRESENT", "PAST SIMPLE", "PAST PARTICIPLE", "TRANSLATE"];
    const ORDER_NORMAL = [0, 1, 2, 3];

    const tbody = document.getElementById("questionsBody");
    const startBtn = document.getElementById("startBtn");
    const checkBtn = document.getElementById("checkBtn");
    const qInfo = document.getElementById("qInfo");
    const scoreInfo = document.getElementById("scoreInfo");
    const summaryDiv = document.getElementById("summary");
    const numQuestionsSelect = document.getElementById("numQuestions");
    const modeSelect = document.getElementById("modeSelect");
    const headerCells = document.querySelectorAll("thead tr th");

    let questions = [];
    let rowStats = [];
    let totalCorrect = 0;
    let totalPossible = 0;
    let currentOrder = ORDER_NORMAL;

    function shuffle(arr) {
      arr = arr.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function normalize(str) {
      return str.toLowerCase()
        .trim()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .replace(/\s+/g, " ")
        .replace(" / ", "/");
    }

    function isTranslationCorrect(user, correct) {
      const normCorrect = normalize(correct);
      let normUser = normalize(user);
      normUser = normUser.replace(/\s*y\s*/g, "/").replace(/,/g, "/");

      const correctParts = normCorrect.split("/").map(x => x.trim());
      const userParts = normUser.split("/").map(x => x.trim());

      for (const u of userParts) {
        if (correctParts.includes(u)) return true;
      }
      return false;
    }

    function updateHeadersForOrder() {
      currentOrder.forEach((origIndex, displayIndex) => {
        headerCells[displayIndex].textContent = HEADERS[origIndex];
      });
    }

    function startQuiz() {
      const n = parseInt(numQuestionsSelect.value, 10);
      const picked = shuffle(verbs).slice(0, n);

      const mode = modeSelect.value;

      if (mode === "laura") {
        currentOrder = shuffle([0, 1, 2, 3]);   // orden aleatorio
      } else {
        currentOrder = ORDER_NORMAL;           // orden normal
      }

      updateHeadersForOrder();

      questions = picked.map(v => ({
        verb: v,
        shownCol: Math.floor(Math.random() * 4)
      }));

      tbody.innerHTML = "";
      rowStats = questions.map(() => ({ correct: 0, possible: 0, td: null }));
      totalCorrect = 0;
      totalPossible = 0;

      questions.forEach((q, index) => {
        const v = q.verb;
        const tr = document.createElement("tr");

        currentOrder.forEach(origIndex => {
          const td = document.createElement("td");
          const prop = COLS[origIndex];
          const val = v[prop];

          const isShown = (origIndex === q.shownCol);
          const isNoApplies = (prop === "pastParticiple" && val === "â€”");

          if (isShown || isNoApplies) {
            td.textContent = val;
            if (isShown) td.classList.add("shown-cell");
          } else {
            const inp = document.createElement("input");
            inp.type = "text";
            inp.dataset.index = index;
            inp.dataset.col = prop;
            td.appendChild(inp);
          }

          tr.appendChild(td);
        });

        const resultTd = document.createElement("td");
        resultTd.classList.add("row-result");
        resultTd.textContent = "â€”";
        tr.appendChild(resultTd);
        rowStats[index].td = resultTd;

        tbody.appendChild(tr);
      });

      qInfo.textContent = `Preguntas totales: ${questions.length}`;
      checkBtn.disabled = false;
      summaryDiv.innerHTML = "";
      scoreInfo.textContent = "PuntuaciÃ³n: 0 / 0";
    }

    function correctAll() {
      totalCorrect = 0;
      totalPossible = 0;

      tbody.querySelectorAll("td").forEach(td => {
        td.classList.remove("ok-cell", "bad-cell");
      });
      rowStats.forEach(stat => {
        if (stat.td) {
          stat.td.textContent = "â€”";
          stat.td.classList.remove("ok", "bad");
        }
        stat.correct = 0;
        stat.possible = 0;
      });

      tbody.querySelectorAll("input").forEach(input => {
        const row = parseInt(input.dataset.index);
        const prop = input.dataset.col;
        const q = questions[row].verb;
        const correctVal = q[prop];
        const userVal = input.value.trim();
        const cell = input.parentElement;

        let ok;
        if (prop === "translate") {
          ok = isTranslationCorrect(userVal, correctVal);
        } else {
          ok = normalize(userVal) === normalize(correctVal);
        }

        totalPossible++;
        rowStats[row].possible++;

        if (ok) {
          rowStats[row].correct++;
          totalCorrect++;
          cell.classList.add("ok-cell");
        } else {
          cell.classList.add("bad-cell");
          cell.innerHTML = `<span style="color:#b91c1c;font-weight:bold">${correctVal}</span>`;
        }
      });

      rowStats.forEach(stat => {
        if (!stat.td) return;
        if (stat.possible === 0) {
          stat.td.textContent = "";
          return;
        }
        stat.td.textContent = `${stat.correct}/${stat.possible}`;
        stat.td.classList.add(stat.correct === stat.possible ? "ok" : "bad");
      });

      let pct = 0;
      if (totalPossible > 0) {
        pct = ((totalCorrect / totalPossible) * 100);
      }
      const pctText = pct.toFixed(1);

      scoreInfo.textContent = `PuntuaciÃ³n: ${totalCorrect} / ${totalPossible} (${pctText}%)`;

      if (pct === 100) {
        summaryDiv.innerHTML = `
          ðŸŽ‰ Â¡Perfecto! 100% âœ…<br>
          <span class="choco-msg">Pide a la profesora Laura tu chocolatina.</span>
        `;
      } else if (pct >= 80) {
        summaryDiv.textContent = "Â¡Muy bien! ðŸ’ª Buen dominio de estos verbos.";
      } else {
        summaryDiv.textContent = "Sigue practicando, Â¡lo harÃ¡s mejor! ðŸ˜Š";
      }

      checkBtn.disabled = true;
    }

    startBtn.addEventListener("click", startQuiz);
    checkBtn.addEventListener("click", correctAll);
  </script>
</body>
</html>